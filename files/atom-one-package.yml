- set_fact: pkgname="{{item}}"

- name: Check whether package '{{item}}' already installed
  become: true
  become_user: training
  shell: "apm list -ip | grep '{{item}}@' | wc -l"
  register: installed
- name: Install '{{item}}' if necessary
  become: true
  become_user: training
  shell: "apm install {{item}}"
  when: installed.stdout=="0"
